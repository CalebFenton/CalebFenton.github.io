<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Decompiling XAPK Files | Caleb Fenton&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="While reviewing new Android reverse engineering questions on Stack Overflow, I came across this request to decompile an .xapk. A brief, non-technical description of the format is described on APKPure’">
<meta property="og:type" content="article">
<meta property="og:title" content="Decompiling XAPK Files">
<meta property="og:url" content="https://CalebFenton.github.io/2016/02/28/decompiling-xapk-files/index.html">
<meta property="og:site_name" content="Caleb Fenton's Blog">
<meta property="og:description" content="While reviewing new Android reverse engineering questions on Stack Overflow, I came across this request to decompile an .xapk. A brief, non-technical description of the format is described on APKPure’">
<meta property="og:image" content="https://CalebFenton.github.io/images/decompiling-xapk/side-lift-king.png">
<meta property="og:updated_time" content="2016-02-28T16:11:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Decompiling XAPK Files">
<meta name="twitter:description" content="While reviewing new Android reverse engineering questions on Stack Overflow, I came across this request to decompile an .xapk. A brief, non-technical description of the format is described on APKPure’">
<meta name="twitter:creator" content="@CalebFenton">
  
    <link rel="alternative" href="/rss2.xml" title="Caleb Fenton&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-74177443-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Caleb Fenton&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Think Like An Attacker</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/rss2.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://CalebFenton.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-decompiling-xapk-files" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/28/decompiling-xapk-files/" class="article-date">
  <time datetime="2016-02-28T15:41:03.000Z" itemprop="datePublished">2016-02-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Decompiling XAPK Files
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>While reviewing new Android reverse engineering questions on Stack Overflow, I came across this request to <a href="http://stackoverflow.com/questions/35070003/decompile-xapk-file" target="_blank" rel="external">decompile an <code>.xapk</code></a>. A brief, non-technical description of the format is described on <a href="https://apkpure.com/xapk.htm" target="_blank" rel="external">APKPure’s website</a>:</p>
<blockquote>
<p>XAPK is a brand new file format standard for Android APK package file. Contains all APK package and obb cache asset file to keep Android games or apps working, it always ends in “.xapk”. To ensure games, applications run perfectly, APK Install one click install makes it easy for Android users directly install .apk, .xapk file to the root directory.<br>obb cache data?<br><a id="more"></a></p>
</blockquote>
<p>The “OBB cache files” are usually pretty big for games and include all of the assets like maps, models, images, music, whatever.</p>
<p>Ok, so it looks like we have a new <strong>APK</strong> format specifically designed for games <em>and</em> it comes with <a href="https://apkpure.com/xapk-installer/com.apkpure.installer" target="_blank" rel="external">its own installer</a>. Since there’s an installer, that might mean the actual <code>.apk</code> is encrypted and embedded in the OBB. Maybe there’s some metadata in the <code>.xapk</code> that tells the installer how to lookup the decryption key from their servers? Maybe I’ll need to search for the <strong>ZIP</strong> magic bytes and carve out the <code>.apk</code>?</p>
<p>Nope. <em>The original <code>.apk</code> is at the root of the <code>.xapk</code> archive.</em> EASY. (read: boring) Shit, I was looking for a challenge!</p>
<p>I downloaded and examined <a href="https://apkpure.com/side-lift-king/org.ammarz.MT" target="_blank" rel="external">Side Lift King</a>.<br><img src="/images/decompiling-xapk/side-lift-king.png" alt="such lift, much king"></p>
<p>Here’s the shasum:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ shasum Side\ Lift\ King_v2.<span class="number">0</span>_apkpure.com.xapk</span><br><span class="line"><span class="number">155</span>dbed0809d49b477c6ab4c52f555cfc8f47144  Side Lift King_v2.<span class="number">0</span>_apkpure.com.xapk</span><br></pre></td></tr></table></figure></p>
<p>The <code>.xapk</code> is just a ZIP file:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ file Side\ Lift\ King_v2.<span class="number">0</span>_apkpure.com.xapk</span><br><span class="line">Side Lift King_v2.<span class="number">0</span>_apkpure.com.xapk: Zip archive data, at least v2.<span class="number">0</span> to extract</span><br></pre></td></tr></table></figure></p>
<p>The original <code>org.ammarz.MT.apk</code> is just floating around:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ unzip Side\ Lift\ King_v2.<span class="number">0</span>_apkpure.com.xapk</span><br><span class="line">Archive:  Side Lift King_v2.<span class="number">0</span>_apkpure.com.xapk</span><br><span class="line"> extracting: org.ammarz.MT.apk</span><br><span class="line"> extracting: icon.png</span><br><span class="line"> extracting: Android/obb/org.ammarz.MT/main.<span class="number">8</span>.org.ammarz.MT.obb</span><br><span class="line"> extracting: manifest.json</span><br></pre></td></tr></table></figure></p>
<p>It’s not encrypted or anything.<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ file org<span class="class">.ammarz</span><span class="class">.MT</span><span class="class">.apk</span></span><br><span class="line">org<span class="class">.ammarz</span><span class="class">.MT</span><span class="class">.apk</span>: Java archive data (JAR)</span><br></pre></td></tr></table></figure></p>
<p>It decompiles fine with apktool:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ apktool d org.ammarz.MT.apk</span><br><span class="line">I: Using Apktool <span class="number">2.0</span>.<span class="number">1</span> on org.ammarz.MT.apk</span><br><span class="line">I: Loading resource table...</span><br><span class="line">I: Decoding AndroidManifest.xml with resources...</span><br><span class="line">I: Loading resource table from file: /Users/caleb/Library/apktool/framework/<span class="number">1</span>.apk</span><br><span class="line">I: Regular manifest package...</span><br><span class="line">I: Decoding file-resources...</span><br><span class="line">I: Decoding values */* XMLs...</span><br><span class="line">I: Baksmaling classes.dex...</span><br><span class="line">I: Copying assets and libs...</span><br><span class="line">I: Copying unknown files...</span><br><span class="line">I: Copying original files...</span><br></pre></td></tr></table></figure></p>
<p>The OBB file, in case you’re curious, is just a <strong>JAR</strong> which contains lots of files in an <code>assets/</code> folder.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ file Android/obb/org.ammarz.MT/main.<span class="number">8</span>.org.ammarz.MT.obb                           <span class="number">1</span> ↵</span><br><span class="line">Android/obb/org.ammarz.MT/main.<span class="number">8</span>.org.ammarz.MT.obb: Java archive data (JAR)</span><br></pre></td></tr></table></figure></p>
<p>The <code>manifest.json</code> must be the file used by the installer. It must be the metadata used by the installer app. Here is a pretty formatted version:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   "<span class="attribute">xapk_version</span>":<span class="value"><span class="number">1</span></span>,</span><br><span class="line">   "<span class="attribute">package_name</span>":<span class="value"><span class="string">"org.ammarz.MT"</span></span>,</span><br><span class="line">   "<span class="attribute">name</span>":<span class="value"><span class="string">"Side Lift King"</span></span>,</span><br><span class="line">   "<span class="attribute">version_code</span>":<span class="value"><span class="string">"8"</span></span>,</span><br><span class="line">   "<span class="attribute">version_name</span>":<span class="value"><span class="string">"2.0"</span></span>,</span><br><span class="line">   "<span class="attribute">min_sdk_version</span>":<span class="value"><span class="string">"9"</span></span>,</span><br><span class="line">   "<span class="attribute">target_sdk_version</span>":<span class="value"><span class="string">"23"</span></span>,</span><br><span class="line">   "<span class="attribute">permissions</span>":<span class="value">[</span><br><span class="line">      <span class="string">"android.permission.INTERNET"</span>,</span><br><span class="line">      <span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>,</span><br><span class="line">      <span class="string">"android.permission.WAKE_LOCK"</span>,</span><br><span class="line">      <span class="string">"android.permission.ACCESS_WIFI_STATE"</span>,</span><br><span class="line">      <span class="string">"com.android.vending.CHECK_LICENSE"</span>,</span><br><span class="line">      <span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>,</span><br><span class="line">      <span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span></span><br><span class="line">   ]</span>,</span><br><span class="line">   "<span class="attribute">total_size</span>":<span class="value"><span class="number">58621386</span></span>,</span><br><span class="line">   "<span class="attribute">expansions</span>":<span class="value">[</span><br><span class="line">      &#123;</span><br><span class="line">         "<span class="attribute">file</span>":<span class="value"><span class="string">"Android/obb/org.ammarz.MT/main.8.org.ammarz.MT.obb"</span></span>,</span><br><span class="line">         "<span class="attribute">install_location</span>":<span class="value"><span class="string">"EXTERNAL_STORAGE"</span></span>,</span><br><span class="line">         "<span class="attribute">install_path</span>":<span class="value"><span class="string">"Android/obb/org.ammarz.MT/main.8.org.ammarz.MT.obb"</span></span><br><span class="line">      </span>&#125;</span><br><span class="line">   ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>If you want to decompile an <code>.xapk</code>, all you have to do is unzip it, look for the original <code>.apk</code>, and decompile it normally.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://CalebFenton.github.io/2016/02/28/decompiling-xapk-files/" data-id="cil6r8iie000qgmaoptb4of4r" class="article-share-link">Share</a>
      
        <a href="https://CalebFenton.github.io/2016/02/28/decompiling-xapk-files/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reversing/">reversing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/02/21/how-does-dalvik-handle-this-registers/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">How does Dalvik handle &#39;this&#39; registers?</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anti-virus/">anti-virus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dalvik/">dalvik</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/realtalk/">realtalk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/research/">research</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reversing/">reversing</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/anti-virus/" style="font-size: 10px;">anti-virus</a> <a href="/tags/dalvik/" style="font-size: 15px;">dalvik</a> <a href="/tags/realtalk/" style="font-size: 10px;">realtalk</a> <a href="/tags/research/" style="font-size: 15px;">research</a> <a href="/tags/reversing/" style="font-size: 10px;">reversing</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/02/28/decompiling-xapk-files/">Decompiling XAPK Files</a>
          </li>
        
          <li>
            <a href="/2016/02/21/how-does-dalvik-handle-this-registers/">How does Dalvik handle &#39;this&#39; registers?</a>
          </li>
        
          <li>
            <a href="/2016/02/16/how-does-dalvik-handle-null-types/">How does Dalvik handle null?</a>
          </li>
        
          <li>
            <a href="/2016/02/07/why-anti-virus-sucks/">Why Anti-Virus Software Sucks</a>
          </li>
        
          <li>
            <a href="/2015/12/21/what-happens-when-a-dex-includes-a-framework-class/">What happens when a DEX includes a framework class?</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Caleb Fenton<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'calebfenton';
  
  var disqus_url = 'https://CalebFenton.github.io/2016/02/28/decompiling-xapk-files/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>